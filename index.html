<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€æ•™å“¡ç”¨ã€‘å­¦æ ¡ã®è‘—ä½œæ¨©ã‚¬ã‚¤ãƒ‰ & ãƒ„ãƒ¼ãƒ«</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-slide-up { animation: slideUp 0.5s ease-out; }
        .animate-scale-in { animation: scaleIn 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans pb-12">

    <!-- Header -->
    <header class="bg-indigo-800 text-white shadow-md">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center gap-2">
                <i data-lucide="school" class="w-8 h-8"></i>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold">ã€æ•™å“¡ç”¨ã€‘å­¦æ ¡ã®è‘—ä½œæ¨©ã‚¬ã‚¤ãƒ‰ & ãƒ„ãƒ¼ãƒ«</h1>
                    <p class="text-xs md:text-sm text-indigo-200">æˆæ¥­ãƒ»æ ¡å‹™ãƒ»è¡Œäº‹ã§ã®è‘—ä½œæ¨©åˆ¤æ–­ã‚µãƒãƒ¼ãƒˆ</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
        <div class="max-w-4xl mx-auto flex">
            <button onclick="setAppMode('checker')" id="tab-checker" class="flex-1 py-4 text-center font-bold flex items-center justify-center gap-2 transition-colors text-indigo-800 border-b-4 border-indigo-800 bg-indigo-50">
                <i data-lucide="check-circle" class="w-5 h-5"></i>
                è‘—ä½œæ¨©è¨ºæ–­ãƒ•ãƒ­ãƒ¼
            </button>
            <button onclick="setAppMode('citation')" id="tab-citation" class="flex-1 py-4 text-center font-bold flex items-center justify-center gap-2 transition-colors text-slate-500 hover:bg-slate-50">
                <i data-lucide="book" class="w-5 h-5"></i>
                å‚è€ƒæ–‡çŒ®ã®æ›¸ãæ–¹
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content" class="max-w-4xl mx-auto p-4 md:p-6 min-h-[60vh]">
        <!-- JSã§ã“ã“ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æç”» -->
    </main>

    <!-- Footer -->
    <footer class="max-w-4xl mx-auto p-4 text-center text-slate-400 text-xs mt-8 pb-12 border-t border-slate-200">
        <p>&copy; 2026 Copyright Guide for Teachers</p>
        <p>å‚è€ƒè³‡æ–™: æ–‡åŒ–åºã€Œè‘—ä½œæ¨©ãƒ†ã‚­ã‚¹ãƒˆã€ / SARTRASé‹ç”¨æŒ‡é‡ / JASRACå­¦æ ¡æ•™è‚²åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</p>
    </footer>

    <!-- JavaScript Application Logic -->
    <script>
        // ==========================================
        // State (çŠ¶æ…‹ç®¡ç†)
        // ==========================================
        const state = {
            appMode: 'checker', // 'checker' | 'citation'
            
            // Checker State
            scene: null,
            history: [],
            currentQuestionId: null,
            result: null,

            // Citation State
            citationType: 'book', // 'book' | 'web' | 'article'
            citationData: {
                author: '',
                title: '',
                publisher: '',
                year: '',
                url: '',
                accessDate: ''
            }
        };

        // ==========================================
        // Data Definitions
        // ==========================================
        const scenes = [
            {
                id: 'class',
                title: 'æˆæ¥­ã§ã®åˆ©ç”¨',
                icon: 'book-open',
                color: 'text-blue-600',
                description: 'æˆæ¥­ã€HRã€å­¦æ ¡è¡Œäº‹ã§ã®è³‡æ–™é…å¸ƒãƒ»æç¤º',
                startQuestion: 'q_class_1'
            },
            {
                id: 'external',
                title: 'å¤–éƒ¨å‘ã‘ï¼ˆãŠä¾¿ã‚Šãƒ»HPç­‰ï¼‰',
                icon: 'send',
                color: 'text-orange-600',
                description: 'å­¦å¹´ã ã‚ˆã‚Šã€å­¦æ ¡HPã€ä¿è­·è€…ä¼šè³‡æ–™ãªã©',
                startQuestion: 'q_external_1'
            }
        ];

        const data = {
            // --- æˆæ¥­ã‚·ãƒ¼ãƒ³ ---
            q_class_1: {
                text: 'ã‚ãªãŸã¯ã€Œæ•™å“¡ã€ã¾ãŸã¯ã€Œæˆæ¥­ã‚’å—ã‘ã‚‹ç”Ÿå¾’ã€ã§ã™ã‹ï¼Ÿ',
                subText: 'äº‹å‹™è·å“¡ã‚„ä¿è­·è€…ãªã©ã€æˆæ¥­å½“äº‹è€…ä»¥å¤–ã«ã‚ˆã‚‹åˆ©ç”¨ã¯ã“ã®ãƒ•ãƒ­ãƒ¼ã®å¯¾è±¡å¤–ã¨ãªã‚Šã¾ã™ã€‚',
                yes: 'q_class_2',
                no: 'r_warn_permission'
            },
            q_class_2: {
                text: 'åˆ©ç”¨ã¯ã€Œæˆæ¥­ã®éç¨‹ã€ã§ã™ã‹ï¼Ÿ',
                subText: 'â€»HRï¼ˆãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ ï¼‰ã€å­¦æ ¡è¡Œäº‹ã€éƒ¨æ´»å‹•ã®æŒ‡å°ã‚‚å«ã¿ã¾ã™ã€‚',
                yes: 'q_class_3',
                no: 'r_warn_pr'
            },
            q_class_3: {
                text: 'ä½¿ç”¨ã™ã‚‹è³‡æ–™ã¯ã€HPã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã€ã¾ãŸã¯å‡ºç‰ˆã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ',
                subText: 'æœªå…¬è¡¨ã®è‘—ä½œç‰©ã‚„ã€é•æ³•ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‚ã®ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚',
                yes: 'q_class_4',
                no: 'r_warn_source'
            },
            q_class_4: {
                text: 'ä½¿ç”¨ã™ã‚‹è³‡æ–™ã¯ã€ãƒ‰ãƒªãƒ«ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ãªã©ã®ã€Œæ•™æå“ã€ã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã‚‚ã®ã§ã™ã‹ï¼Ÿ',
                subText: 'ç”Ÿå¾’ãŒè³¼å…¥ã™ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦å¸‚è²©ã•ã‚Œã¦ã„ã‚‹è³‡æ–™ã®ã“ã¨ã§ã™ã€‚',
                yes: 'r_ng_drill',
                no: 'r_ok_class'
            },

            // --- å¤–éƒ¨å‘ã‘ã‚·ãƒ¼ãƒ³ï¼ˆæ—§ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ– + ã‚¤ãƒ™ãƒ³ãƒˆè¦ç´ ï¼‰ ---
            q_external_1: {
                text: 'åˆ©ç”¨ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹è‘—ä½œç‰©ã¯ã€ã™ã§ã«å…¬è¡¨ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ',
                yes: 'q_external_2',
                no: 'r_ng_unpublished'
            },
            q_external_2: {
                text: 'ã€Œå¼•ç”¨ã€ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹å ´åˆã€è‡ªåˆ†ã®æ–‡ç« ãŒã€Œä¸»ã€ã§ã€ä»–äººã®è‘—ä½œç‰©ãŒã€Œå¾“ã€ã®é–¢ä¿‚ã§ã™ã‹ï¼Ÿ',
                subText: 'å˜ãªã‚‹è»¢è¼‰ï¼ˆã‚«ãƒƒãƒˆã‚¤ãƒ©ã‚¹ãƒˆã¨ã—ã¦ã®åˆ©ç”¨ãªã©ï¼‰ã‚„ã€é£¾ã‚Šã¨ã—ã¦ã®åˆ©ç”¨ã¯å¼•ç”¨ã«ãªã‚Šã¾ã›ã‚“ã€‚',
                yes: 'q_external_3',
                no: 'r_ng_relation'
            },
            q_external_3: {
                text: 'å‡ºå…¸ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»è‘—ä½œè€…åãªã©ï¼‰ã‚’æ˜è¨˜ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ',
                yes: 'q_external_4',
                no: 'r_ng_source'
            },
            q_external_4: {
                text: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼ˆå­¦æ ¡HPã‚„SNSï¼‰ã§å…¬é–‹ã™ã‚‹äºˆå®šã§ã™ã‹ï¼Ÿ',
                yes: 'r_check_online',
                no: 'r_ok_quote'
            },

            // --- çµæœãƒ‡ãƒ¼ã‚¿ ---
            
            // æˆæ¥­ãƒ•ãƒ­ãƒ¼çµæœ
            r_warn_permission: {
                type: 'warning',
                title: 'çµæœï¼šè¦æ³¨æ„',
                message: 'åŸå‰‡ã¨ã—ã¦ã€Œè¨±è«¾ã€ãŒå¿…è¦ã§ã™ã€‚',
                details: 'æˆæ¥­æ‹…å½“è€…ä»¥å¤–ï¼ˆäº‹å‹™è·å“¡ç­‰ï¼‰ã«ã‚ˆã‚‹è¤‡è£½ã¯35æ¡ã®å¯¾è±¡å¤–ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                proposal: {
                    text: 'è»¢è¼‰å¯èƒ½ãªã‚‚ã®ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ã€Œå‚è€ƒæ–‡çŒ®ãƒ»å¼•ç”¨æ–‡çŒ®ã®æ›¸ãæ–¹ã€ã¯ã“ã¡ã‚‰ã€‚',
                    action: 'citation'
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬35æ¡ é©ç”¨å¤–'
            },
            r_warn_pr: {
                type: 'warning',
                title: 'çµæœï¼šè¦æ³¨æ„',
                message: 'å­¦æ ¡åºƒå ±ã‚„HPæ²è¼‰ãªã©ã¯ã€Œå¤–éƒ¨å‘ã‘ã€ãƒ•ãƒ­ãƒ¼ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
                details: 'ã€Œæˆæ¥­ã®éç¨‹ã€ã§ã¯ãªã„åˆ©ç”¨ï¼ˆå­¦æ ¡ç´¹ä»‹ãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã€ä¿è­·è€…å‘ã‘åºƒå ±ãªã©ï¼‰ã¯ã€35æ¡ï¼ˆç„¡è¨±è«¾åˆ©ç”¨ï¼‰ã®å¯¾è±¡å¤–ã§ã™ã€‚',
                proposal: {
                    text: 'æœ€åˆã«æˆ»ã‚Šã€Œå¤–éƒ¨å‘ã‘ã€ã‚’é¸æŠã—ã¦è¨ºæ–­ã—ç›´ã™',
                    action: 'reset'
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬35æ¡ é©ç”¨å¤–'
            },
            r_warn_source: {
                type: 'warning',
                title: 'çµæœï¼šè¦æ³¨æ„',
                message: 'å‡ºæ‰€ä¸æ˜ãƒ»é•æ³•å…¥æ‰‹ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                details: 'é•æ³•ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã¨çŸ¥ã‚ŠãªãŒã‚‰åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚',
                proposal: {
                    text: 'è»¢è¼‰å¯èƒ½ãªã‚‚ã®ã‹ç¢ºèªã‚’ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã‚‚æ²è¼‰å¯èƒ½ãªç´ æã‚µã‚¤ãƒˆãªã©ã‚’æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚',
                    linkText: 'æˆæ¥­ç›®çš„å…¬è¡†é€ä¿¡è£œå„Ÿé‡‘åˆ¶åº¦ (SARTRAS) ã«ã¤ã„ã¦',
                    linkUrl: 'https://sartras.or.jp/'
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬35æ¡'
            },
            r_ng_drill: {
                type: 'ng',
                title: 'çµæœï¼šåŸå‰‡ä½¿ãˆã¾ã›ã‚“',
                message: 'æ•™æå“ã®ã‚³ãƒ”ãƒ¼ãƒ»é…å¸ƒã¯åŸå‰‡ã§ãã¾ã›ã‚“ã€‚',
                details: 'ãƒ‰ãƒªãƒ«ã‚„ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ãªã©ã€ç”Ÿå¾’ãŒè³¼å…¥ã™ã‚‹ã“ã¨ã‚’å‰æã¨ã—ãŸè³‡æ–™ã®ã‚³ãƒ”ãƒ¼ã¯ã€Œè‘—ä½œè€…ã®åˆ©ç›Šã‚’ä¸å½“ã«å®³ã™ã‚‹ã€ãŸã‚ã€35æ¡ã®ä¾‹å¤–è¦å®šãŒé©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚',
                proposal: {
                    text: 'ãã®æ•™æã‚’å…¨ç”Ÿå¾’åˆ†è³¼å…¥ã—ã¾ã—ã‚‡ã†ã€‚',
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬35æ¡ ãŸã ã—æ›¸ã'
            },
            r_ok_class: {
                type: 'ok',
                title: 'åˆ©ç”¨å¯èƒ½ã§ã™',
                message: 'è‘—ä½œæ¨©æ³•ç¬¬35æ¡ã«ã‚ˆã‚Šã€æˆæ¥­ã§ã®åˆ©ç”¨ã¯è¨±è«¾ãªãè¡Œãˆã¾ã™ã€‚',
                details: 'å¿…è¦ã¨èªã‚ã‚‰ã‚Œã‚‹é™åº¦å†…ã§ã€å‡ºæ‰€ã®æ˜ç¤ºã‚’è¡Œã†ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æˆæ¥­ã§ã®é…ä¿¡ã‚‚SARTRASåŠ å…¥æ ¡ã§ã‚ã‚Œã°å¯èƒ½ã§ã™ã€‚',
                proposal: {
                    text: 'å¿µã®ãŸã‚ã€å‡ºå…¸ã®è¨˜è¼‰æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚',
                    action: 'citation'
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬35æ¡'
            },

            // å¤–éƒ¨å‘ã‘ãƒ•ãƒ­ãƒ¼çµæœ
            r_ok_quote: {
                type: 'ok',
                title: 'å¼•ç”¨ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã™',
                message: 'æ­£å½“ãªç¯„å›²å†…ã§ã®ã€Œå¼•ç”¨ã€ã§ã‚ã‚Œã°è¨±è«¾ã¯ä¸è¦ã§ã™ã€‚',
                details: 'å­¦å¹´ã ã‚ˆã‚Šç­‰ã®ç´™åª’ä½“ã§ã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚å¿…ãšå‡ºå…¸ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚',
                proposal: {
                    text: 'æ­£ã—ã„å‚è€ƒæ–‡çŒ®ã®æ›¸ãæ–¹ã‚’ä½œæˆã™ã‚‹',
                    action: 'citation'
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬32æ¡'
            },
            r_check_online: {
                type: 'warning',
                title: 'Webå…¬é–‹ã¯è¦æ³¨æ„',
                message: 'ã€Œå¼•ç”¨ã€è¦ä»¶ã‚’æº€ãŸã›ã°å¯èƒ½ã§ã™ãŒã€è‚–åƒæ¨©ç­‰ã«ã‚‚é…æ…®ãŒå¿…è¦ã§ã™ã€‚',
                details: 'å­¦æ ¡HPã§ã®å…¬é–‹ã¯å…¨ä¸–ç•Œã¸ã®ç™ºä¿¡ï¼ˆå…¬è¡†é€ä¿¡ï¼‰ã¨ãªã‚Šã¾ã™ã€‚å¼•ç”¨ã®å¿…ç„¶æ€§ã‚„ä¸»å¾“é–¢ä¿‚ã‚’å³æ ¼ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚å†™çœŸã«ç”Ÿå¾’ãŒå†™ã‚Šè¾¼ã‚“ã§ã„ãªã„ã‹ã‚‚ç¢ºèªãŒå¿…è¦ã§ã™ã€‚',
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬23æ¡ï¼ˆå…¬è¡†é€ä¿¡æ¨©ï¼‰'
            },
            r_ng_unpublished: { 
                type: 'ng', 
                title: 'NG', 
                message: 'æœªå…¬è¡¨ã®è‘—ä½œç‰©ã¯å¼•ç”¨ã§ãã¾ã›ã‚“ã€‚', 
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬18æ¡' 
            },
            r_ng_relation: { 
                type: 'ng', 
                title: 'NGï¼ˆè¨±è«¾ãŒå¿…è¦ã§ã™ï¼‰', 
                message: 'ãŸã ã®è»¢è¼‰ï¼ˆã‚¤ãƒ©ã‚¹ãƒˆåˆ©ç”¨ãªã©ï¼‰ã¯å¼•ç”¨ã«ãªã‚Šã¾ã›ã‚“ã€‚', 
                details: 'ãŠä¾¿ã‚Šã®æŒ¿çµµã¨ã—ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãªã©ã‚’ä½¿ã†å ´åˆã¯ã€åŸå‰‡ã¨ã—ã¦è‘—ä½œè€…ã®è¨±è«¾ãŒå¿…è¦ã§ã™ã€‚ãƒ•ãƒªãƒ¼ç´ æãªã©ã‚’æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚',
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬32æ¡ é©ç”¨å¤–' 
            },
            r_ng_source: {
                type: 'ng',
                title: 'NG',
                message: 'å‡ºå…¸ã®è¨˜è¼‰ãŒãªã„åˆ©ç”¨ã¯èªã‚ã‚‰ã‚Œã¾ã›ã‚“ã€‚',
                proposal: {
                    text: 'å‡ºå…¸ã®æ›¸ãæ–¹ã‚’ç¢ºèªã™ã‚‹',
                    action: 'citation'
                },
                legal: 'è‘—ä½œæ¨©æ³•ç¬¬48æ¡'
            }
        };

        // ==========================================
        // Functions (ãƒ­ã‚¸ãƒƒã‚¯)
        // ==========================================

        function setAppMode(mode) {
            state.appMode = mode;
            render();
        }

        function setScene(sceneId) {
            state.scene = scenes.find(s => s.id === sceneId);
            state.currentQuestionId = state.scene.startQuestion;
            state.history = [];
            state.result = null;
            render();
        }

        function handleAnswer(answer) {
            const currentQuestion = data[state.currentQuestionId];
            const nextId = answer ? currentQuestion.yes : currentQuestion.no;

            state.history.push(state.currentQuestionId);

            if (nextId.startsWith('r_')) {
                state.result = data[nextId];
                state.currentQuestionId = null;
            } else {
                state.currentQuestionId = nextId;
            }
            render();
        }

        function resetChecker() {
            state.scene = null;
            state.currentQuestionId = null;
            state.result = null;
            state.history = [];
            render();
        }

        function goBack() {
            if (state.history.length === 0) {
                resetChecker();
                return;
            }
            const prevQuestionId = state.history.pop();
            state.result = null;
            state.currentQuestionId = prevQuestionId;
            render();
        }

        // --- Citation Functions ---
        function setCitationType(type) {
            state.citationType = type;
            render();
        }

        function updateCitationData(field, value) {
            state.citationData[field] = value;
            renderPreviewOnly();
        }

        function getFormattedCitation() {
            const { author, title, publisher, year, url, accessDate } = state.citationData;
            const type = state.citationType;

            if (type === 'book') {
                if (!author && !title) return 'ï¼ˆæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰';
                return `${author || 'è‘—è€…å'}. ã€${title || 'æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ«'}ã€. ${publisher || 'å‡ºç‰ˆç¤¾'}, ${year || 'å‡ºç‰ˆå¹´'}.`;
            } else if (type === 'web') {
                if (!title && !url) return 'ï¼ˆæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰';
                return `${author ? author + '. ' : ''}â€œ${title || 'Webãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«'}â€. ${publisher || 'Webã‚µã‚¤ãƒˆå'}. ${url || 'URL'}, (å‚ç…§ ${accessDate || 'é–²è¦§æ—¥'}).`;
            } else if (type === 'article') {
                if (!title) return 'ï¼ˆæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰';
                return `${author || 'è‘—è€…å'}. â€œ${title || 'è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«'}â€. ${publisher || 'æ²è¼‰èªŒå'}. ${year || 'ç™ºè¡Œå¹´'}, p.xx-xx.`;
            }
            return '';
        }

        // ==========================================
        // Rendering (æç”»)
        // ==========================================
        
        function renderPreviewOnly() {
            const previewEl = document.getElementById('citation-preview');
            if (previewEl) {
                previewEl.textContent = getFormattedCitation();
            }
        }

        function render() {
            const mainContent = document.getElementById('main-content');
            const tabChecker = document.getElementById('tab-checker');
            const tabCitation = document.getElementById('tab-citation');

            // Header Tabs Styling
            if (state.appMode === 'checker') {
                tabChecker.className = 'flex-1 py-4 text-center font-bold flex items-center justify-center gap-2 transition-colors text-indigo-800 border-b-4 border-indigo-800 bg-indigo-50';
                tabCitation.className = 'flex-1 py-4 text-center font-bold flex items-center justify-center gap-2 transition-colors text-slate-500 hover:bg-slate-50';
            } else {
                tabChecker.className = 'flex-1 py-4 text-center font-bold flex items-center justify-center gap-2 transition-colors text-slate-500 hover:bg-slate-50';
                tabCitation.className = 'flex-1 py-4 text-center font-bold flex items-center justify-center gap-2 transition-colors text-emerald-600 border-b-4 border-emerald-600 bg-emerald-50';
            }

            let html = '';

            if (state.appMode === 'checker') {
                html += '<div class="animate-fade-in">';

                // Scene Selection (Default View)
                if (!state.scene) {
                    html += `
                        <div class="animate-slide-up">
                            <div class="mb-6 text-center">
                                <h2 class="text-xl font-bold text-slate-700 mb-2">
                                    ã©ã®ã‚ˆã†ãªå ´é¢ã§ã™ã‹ï¼Ÿ
                                </h2>
                                <p class="text-sm text-slate-500">è©²å½“ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6 max-w-3xl mx-auto">
                                ${scenes.map(s => `
                                    <button onclick="setScene('${s.id}')" class="bg-white p-8 rounded-xl shadow-sm hover:shadow-md border border-slate-200 flex flex-col items-center text-center transition-all hover:bg-slate-50 group h-full">
                                        <div class="transform group-hover:scale-110 transition-transform duration-200">
                                            <i data-lucide="${s.icon}" class="w-12 h-12 mb-4 ${s.color}"></i>
                                        </div>
                                        <h3 class="font-bold text-xl mb-3 text-slate-800">${s.title}</h3>
                                        <p class="text-sm text-slate-500 leading-relaxed">${s.description}</p>
                                    </button>
                                `).join('')}
                            </div>

                            <div class="mt-8 bg-blue-50 p-4 rounded-lg text-sm text-blue-800 flex gap-3 border border-blue-100 max-w-3xl mx-auto">
                                <i data-lucide="info" class="w-5 h-5 flex-shrink-0 mt-0.5"></i>
                                <div>
                                    <p class="font-bold mb-1">æœ¬ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦</p>
                                    <p>
                                        æ–‡åŒ–åºã®è³‡æ–™ç­‰ã‚’åŸºã«ä½œæˆã—ãŸæ•™å“¡å‘ã‘ã®ç°¡æ˜“åˆ¤æ–­ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
                                        æœ€çµ‚çš„ãªæ³•çš„åˆ¤æ–­ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¿·ã£ãŸå ´åˆã¯ç®¡ç†è·ã‚„è‡ªæ²»ä½“ã®æ³•å‹™æ‹…å½“ã«ã”ç›¸è«‡ãã ã•ã„ã€‚
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Question Flow
                else if (state.scene && !state.result && state.currentQuestionId) {
                    const q = data[state.currentQuestionId];
                    html += `
                        <div class="bg-white rounded-xl shadow-lg border border-slate-100 overflow-hidden animate-slide-up mt-4">
                            <div class="bg-slate-100 p-3 px-6 flex justify-between items-center border-b border-slate-200">
                                <span class="font-bold text-slate-700 flex items-center gap-2">
                                    <i data-lucide="${state.scene.icon}" class="${state.scene.color}"></i>
                                    ${state.scene.title}
                                </span>
                                <button onclick="resetChecker()" class="text-xs text-slate-500 hover:text-indigo-600 flex items-center gap-1 font-bold">
                                    <i data-lucide="rotate-ccw" class="w-3 h-3"></i> æœ€åˆã‹ã‚‰
                                </button>
                            </div>
                            
                            <div class="p-8 text-center">
                                <h3 class="text-xl md:text-2xl font-bold mb-4 leading-relaxed text-slate-800">
                                    ${q.text}
                                </h3>
                                ${q.subText ? `
                                    <p class="text-slate-600 text-sm mb-8 bg-yellow-50 inline-block px-4 py-3 rounded-lg border border-yellow-100 text-left md:text-center">
                                        ğŸ’¡ ${q.subText}
                                    </p>
                                ` : ''}
                                
                                <div class="flex flex-col md:flex-row gap-4 justify-center mt-4">
                                    <button onclick="handleAnswer(true)" class="bg-indigo-700 hover:bg-indigo-800 text-white px-8 py-4 rounded-lg font-bold text-lg shadow-md transition-transform active:scale-95 flex-1 md:max-w-xs flex items-center justify-center gap-2">
                                        <i data-lucide="check" class="w-6 h-6"></i> ã¯ã„
                                    </button>
                                    <button onclick="handleAnswer(false)" class="bg-white border-2 border-slate-300 hover:bg-slate-100 text-slate-700 px-8 py-4 rounded-lg font-bold text-lg shadow-sm transition-transform active:scale-95 flex-1 md:max-w-xs flex items-center justify-center gap-2">
                                        <i data-lucide="x" class="w-6 h-6"></i> ã„ã„ãˆ
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-slate-50 p-3 border-t border-slate-100">
                                <button onclick="goBack()" class="text-slate-500 text-sm hover:underline px-4 flex items-center gap-1">
                                    <i data-lucide="chevron-left" class="w-4 h-4"></i> å‰ã®è³ªå•ã«æˆ»ã‚‹
                                </button>
                            </div>
                        </div>
                    `;
                }

                // Result Display
                else if (state.result) {
                    const r = state.result;
                    let borderColor, bgColor, icon, textColor;
                    
                    if (r.type === 'ok') {
                        borderColor = 'border-emerald-500';
                        bgColor = 'bg-emerald-100';
                        icon = 'check-circle';
                        textColor = 'text-emerald-800';
                    } else if (r.type === 'ng') {
                        borderColor = 'border-red-500';
                        bgColor = 'bg-red-100';
                        icon = 'x-circle';
                        textColor = 'text-red-800';
                    } else {
                        borderColor = 'border-amber-500';
                        bgColor = 'bg-amber-100';
                        icon = 'alert-triangle';
                        textColor = 'text-amber-900';
                    }

                    html += `
                        <div class="animate-scale-in mt-4">
                            <div class="rounded-xl shadow-xl overflow-hidden border-2 ${borderColor} bg-white">
                                
                                <div class="p-6 text-center ${bgColor} ${textColor} border-b ${borderColor}">
                                    <i data-lucide="${icon}" class="w-16 h-16 mx-auto mb-3"></i>
                                    <h2 class="text-2xl font-bold tracking-tight">${r.title}</h2>
                                    <p class="font-bold text-lg mt-2 opacity-90">${r.message}</p>
                                </div>

                                <div class="p-6 md:p-8 space-y-6">
                                    
                                    ${r.details ? `
                                        <div>
                                            <h4 class="font-bold text-slate-700 mb-2 flex items-center gap-2">
                                                <i data-lucide="info" class="w-4 h-4"></i> è§£èª¬
                                            </h4>
                                            <p class="text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-lg border border-slate-100">
                                                ${r.details}
                                            </p>
                                        </div>
                                    ` : ''}

                                    ${r.proposal ? `
                                        <div class="bg-white border-2 border-indigo-100 rounded-xl p-5 shadow-sm">
                                            <h4 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                                                <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-500"></i>
                                                ææ¡ˆãƒ»ãƒã‚¯ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                                            </h4>
                                            <div class="space-y-3">
                                                <p class="text-slate-800 font-medium flex items-start gap-2">
                                                    <i data-lucide="check" class="w-5 h-5 text-indigo-500 flex-shrink-0"></i>
                                                    ${r.proposal.text}
                                                </p>
                                                ${r.proposal.action === 'citation' ? `
                                                    <button onclick="setAppMode('citation')" class="ml-7 mt-2 text-sm bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 inline-flex items-center gap-1 transition-colors">
                                                        <i data-lucide="arrow-right" class="w-4 h-4"></i> å‚è€ƒæ–‡çŒ®ã®æ›¸ãæ–¹ãƒšãƒ¼ã‚¸ã¸
                                                    </button>
                                                ` : ''}
                                                ${r.proposal.action === 'reset' ? `
                                                    <button onclick="resetChecker()" class="ml-7 mt-2 text-sm bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 inline-flex items-center gap-1 transition-colors">
                                                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i> æœ€åˆã«æˆ»ã‚‹
                                                    </button>
                                                ` : ''}
                                                ${r.proposal.linkUrl ? `
                                                    <a href="${r.proposal.linkUrl}" target="_blank" rel="noopener noreferrer" class="ml-7 mt-2 text-sm text-indigo-600 underline hover:text-indigo-800 inline-flex items-center gap-1">
                                                        ${r.proposal.linkText || 'é–¢é€£ãƒªãƒ³ã‚¯ã‚’é–‹ã'}
                                                        <i data-lucide="external-link" class="w-3 h-3"></i>
                                                    </a>
                                                ` : ''}
                                            </div>
                                        </div>
                                    ` : ''}

                                    <div class="pt-4 border-t border-slate-100 flex justify-between items-center text-xs text-slate-400">
                                        <span class="font-mono bg-slate-100 px-2 py-1 rounded">æ ¹æ‹ æ³•: ${r.legal}</span>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 border-t border-slate-200 text-center">
                                    <button onclick="resetChecker()" class="text-indigo-700 font-bold hover:bg-indigo-50 px-6 py-2 rounded-lg transition-colors inline-flex items-center gap-2">
                                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                        ä»–ã®ã‚±ãƒ¼ã‚¹ã‚’è¨ºæ–­ã™ã‚‹
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                html += '</div>';
            }

            // Mode: Citation (Existing Logic)
            else if (state.appMode === 'citation') {
                html += `
                    <div class="animate-fade-in max-w-3xl mx-auto">
                        <div class="text-center mb-8">
                            <h2 class="text-2xl font-bold text-slate-800 mb-2">å‚è€ƒæ–‡çŒ®ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                            <p class="text-slate-500">
                                ç”Ÿå¾’ã¸ã®æŒ‡å°ã‚„ã€ã”è‡ªèº«ã®è³‡æ–™ä½œæˆã«ã”æ´»ç”¨ãã ã•ã„ã€‚
                            </p>
                        </div>

                        <!-- Type Select -->
                        <div class="flex gap-2 mb-6 justify-center">
                            <button onclick="setCitationType('book')" class="px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 transition-all ${state.citationType === 'book' ? 'bg-emerald-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}">
                                <i data-lucide="book" class="w-4 h-4"></i> æ›¸ç±ãƒ»æœ¬
                            </button>
                            <button onclick="setCitationType('web')" class="px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 transition-all ${state.citationType === 'web' ? 'bg-emerald-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}">
                                <i data-lucide="globe" class="w-4 h-4"></i> Webã‚µã‚¤ãƒˆ
                            </button>
                            <button onclick="setCitationType('article')" class="px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 transition-all ${state.citationType === 'article' ? 'bg-emerald-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}">
                                <i data-lucide="file-text" class="w-4 h-4"></i> è«–æ–‡ãƒ»è¨˜äº‹
                            </button>
                        </div>

                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- Input Form -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="font-bold text-lg mb-4 text-slate-700 border-b pb-2">æƒ…å ±ã®å…¥åŠ›</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">è‘—è€…ãƒ»ä½œæˆè€…</label>
                                        <input type="text" oninput="updateCitationData('author', this.value)" value="${state.citationData.author}" placeholder="ä¾‹: å¤ç›® æ¼±çŸ³" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">
                                            ${state.citationType === 'web' ? 'Webãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«' : state.citationType === 'article' ? 'è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«' : 'æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ«'}
                                        </label>
                                        <input type="text" oninput="updateCitationData('title', this.value)" value="${state.citationData.title}" placeholder="${state.citationType === 'web' ? 'ä¾‹: è‘—ä½œæ¨©ã®æ¦‚è¦' : 'ä¾‹: å¾è¼©ã¯çŒ«ã§ã‚ã‚‹'}" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                    </div>
                                    
                                    ${state.citationType !== 'web' ? `
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-1">
                                                ${state.citationType === 'article' ? 'æ²è¼‰èªŒå' : 'å‡ºç‰ˆç¤¾'}
                                            </label>
                                            <input type="text" oninput="updateCitationData('publisher', this.value)" value="${state.citationData.publisher}" placeholder="${state.citationType === 'article' ? 'ä¾‹: å›½èªæ•™è‚²ç ”ç©¶' : 'ä¾‹: å²©æ³¢æ›¸åº—'}" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                        </div>
                                    ` : ''}

                                    ${state.citationType === 'web' ? `
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-1">Webã‚µã‚¤ãƒˆåï¼ˆé‹å–¶å…ƒï¼‰</label>
                                            <input type="text" oninput="updateCitationData('publisher', this.value)" value="${state.citationData.publisher}" placeholder="ä¾‹: æ–‡åŒ–åºã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                        </div>
                                    ` : ''}

                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">ç™ºè¡Œå¹´ãƒ»å…¬é–‹å¹´</label>
                                        <input type="text" oninput="updateCitationData('year', this.value)" value="${state.citationData.year}" placeholder="ä¾‹: 2023" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                    </div>

                                    ${state.citationType === 'web' ? `
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-1">URL</label>
                                            <input type="text" oninput="updateCitationData('url', this.value)" value="${state.citationData.url}" placeholder="https://..." class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-1">é–²è¦§æ—¥ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ—¥ï¼‰</label>
                                            <input type="text" oninput="updateCitationData('accessDate', this.value)" value="${state.citationData.accessDate}" placeholder="ä¾‹: 2024-05-20" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            <!-- Preview -->
                            <div class="space-y-6">
                                <div class="bg-slate-800 text-white p-6 rounded-xl shadow-lg relative">
                                    <h3 class="font-bold text-sm text-slate-400 mb-4 uppercase tracking-widest">Preview</h3>
                                    
                                    <div id="citation-preview" class="bg-slate-900 p-4 rounded font-mono text-sm leading-relaxed min-h-[100px] flex items-center">
                                        ${getFormattedCitation() || '<span class="text-slate-600">å·¦å´ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã™ã‚‹ã¨ã€ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</span>'}
                                    </div>
                                </div>

                                <div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg">
                                    <h4 class="font-bold text-emerald-800 mb-2 text-sm">æ›¸ãæ–¹ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆSIST02æº–æ‹ ï¼‰</h4>
                                    <ul class="text-sm text-emerald-700 space-y-2 list-disc pl-4">
                                        ${state.citationType === 'book' ? `
                                            <li>è‘—è€…ãŒè¤‡æ•°ã®å ´åˆã¯ã€Œãƒ»ã€ã‚„ã€Œ,ã€ã§åŒºåˆ‡ã‚Šã¾ã™ã€‚</li>
                                            <li>ç‰ˆæ•°ï¼ˆç¬¬2ç‰ˆãªã©ï¼‰ãŒã‚ã‚‹å ´åˆã¯ã‚¿ã‚¤ãƒˆãƒ«ã®å¾Œã«è¨˜è¿°ã—ã¾ã™ã€‚</li>
                                        ` : ''}
                                        ${state.citationType === 'web' ? `
                                            <li>Webã‚µã‚¤ãƒˆã¯å†…å®¹ãŒæ›¸ãæ›ã‚ã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€ã€Œé–²è¦§æ—¥ã€ãŒéå¸¸ã«é‡è¦ã§ã™ã€‚</li>
                                            <li>URLã¯é€”ä¸­ã§æ”¹è¡Œã›ãšã€ãƒªãƒ³ã‚¯ãŒåˆ‡ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</li>
                                        ` : ''}
                                        ${state.citationType === 'article' ? `
                                            <li>æ²è¼‰èªŒåã®å¾Œã«ã€Œå·»ãƒ»å·ã€ã¨ã€å¼•ç”¨ç®‡æ‰€ã¾ãŸã¯å…¨ä½“ã®ã€Œãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆp.xx-xxï¼‰ã€ã‚’å¿…ãšè¨˜è¼‰ã—ã¾ã™ã€‚</li>
                                            <li>è‹±èªã®è«–æ–‡ã®å ´åˆã€ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚¤ã‚¿ãƒªãƒƒã‚¯ä½“ã«ã™ã‚‹ãªã©ã®ãƒ«ãƒ¼ãƒ«ãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
                                        ` : ''}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            mainContent.innerHTML = html;
            lucide.createIcons();
        }

        render();

    </script>
</body>
</html>
